<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LootGen</title>
  <link rel="stylesheet" href="css/nodal.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="js/defaults.js"></script>
  <script src="js/form.js"></script>
  <script src="js/lootgen.js"></script>
  <script src="js/nodal.js"></script>
</head>

<body>
  <main class="page">
    <h1>Secret Sauce LootGen</h1>
    <div class="hero">
      <p>ARPG progression generator by <a href="https://chien-games.itch.io/" target="_blank">Charles Torris</a>.
        Press compute to generate loot and build simulation.</p>
      <div class="hero-actions">
        <button id="compute-btn-top" type="button" class="compute-btn">Compute all levels</button>
      </div>
    </div>

    <form id="config-form" class="config-form" autocomplete="off">
      <div class="config-columns">
        <div class="config-column">
          <details class="form-section form-section-build-config">
            <summary class="section-title">Game Configuration</summary>
            <div class="field">
              <label title="Slots available for items; affects which items can be rolled and equipped.">Equipment
                slots</label>
              <div class="tag-list" data-tags="equipment_slots"></div>
              <div class="tag-input">
                <button type="button" data-target="equipment_slots">Add</button>
              </div>
            </div>

            <div class="field">
              <label title="Damage and resistance types used for affixes and scaling.">Damage/resistances types</label>
              <div class="tag-list" data-tags="damage_types"></div>
              <div class="tag-input">
                <button type="button" data-target="damage_types">Add</button>
              </div>
            </div>

            <div class="field">
              <label title="Rarity categories with unlock levels and affix counts.">Categories</label>
              <div class="tag-list" data-tags="categories"></div>
              <div class="tag-input">
                <button type="button" data-target="categories">Add</button>
              </div>
            </div>

            <div class="field">
              <label title="Item definitions (slot, size, affix cap, damage source flags).">Items</label>
              <div class="tag-list" data-tags="items"></div>
              <div class="tag-input">
                <button type="button" data-target="items">Add</button>
              </div>
            </div>

            <div class="field">
              <label title="Skills available for the build; used for display only here.">Skills</label>
              <div class="tag-list" data-tags="skills"></div>
              <div class="tag-input">
                <button type="button" data-target="skills">Add</button>
              </div>
            </div>
          </details>


          <details class="form-section form-section-bases">
            <summary class="section-title">Bases</summary>
            <div class="field-grid">
              <div class="field">
                <label for="levels" title="Maximum character level simulated. Increases loops/loot generations.">Level
                  Max</label>
                <input type="number" id="levels" name="levels" min="1" max="200" step="1">
              </div>

              <div class="field">
                <label for="skill-slots"
                  title="Target number of skill slots in the build; used for balance context only.">Optimal number of
                  skills</label>
                <input type="number" id="skill-slots" name="skill_slots" min="1" max="12" step="1">
              </div>

              <div class="field full-span">
                <label title="Starting min/max bounds for each attribute; impact starting stats and growth caps.">Base
                  stats</label>
                <div class="attr-table">
                  <div class="attr-row header">
                    <span>Type</span>
                    <span>Min</span>
                    <span>Max</span>
                  </div>
                  <div class="attr-row" data-attr="force">
                    <span>Force</span>
                    <input type="number" min="10" max="200" step="1" class="attr-number" data-attr="force"
                      data-kind="min" placeholder="Min">
                    <input type="number" min="10" max="200" step="1" class="attr-number" data-attr="force"
                      data-kind="max" placeholder="Max">
                  </div>
                  <div class="attr-row" data-attr="intelligence">
                    <span>Intelligence</span>
                    <input type="number" min="10" max="200" step="1" class="attr-number" data-attr="intelligence"
                      data-kind="min" placeholder="Min">
                    <input type="number" min="10" max="200" step="1" class="attr-number" data-attr="intelligence"
                      data-kind="max" placeholder="Max">
                  </div>
                  <div class="attr-row" data-attr="dexterity">
                    <span>Dexterity</span>
                    <input type="number" min="10" max="200" step="1" class="attr-number" data-attr="dexterity"
                      data-kind="min" placeholder="Min">
                    <input type="number" min="10" max="200" step="1" class="attr-number" data-attr="dexterity"
                      data-kind="max" placeholder="Max">
                  </div>
                </div>
              </div>

              <div class="field">
                <label for="unarmed-physical-damage"
                  title="Base physical damage with no weapon; scales with unarmed growth.">Unarmed physical
                  damage</label>
                <input type="number" id="unarmed-physical-damage" name="unarmed_physical_damage" min="0" step="1">
              </div>

              <div class="field">
                <label for="base-physical-resistance" title="Starting physical resistance before gear.">Base physical
                  resistance</label>
                <input type="number" id="base-physical-resistance" name="base_physical_resistance" min="0" step="1">
              </div>

              <div class="field">
                <label for="attack-speed-base" title="Attacks per second before any attack speed bonuses.">Base attack
                  speed</label>
                <input type="number" id="attack-speed-base" name="attack_speed_base" min="0" step="0.01">
              </div>
            </div>
          </details>

        </div>

        </details>

        <details class="form-section form-section-base-stats" style="background-color: #245528;">
          <summary class="section-title">Base Stat Progression</summary>
          <div class="field-grid">
            <div class="field">
              <label for="stats-progression-model"
                title="How stat gains are distributed per level (balanced or favoring one stat).">Stats progression
                model</label>
              <select id="stats-progression-model" name="stats_progression_model">
                <option value="balanced">Balanced (random spread)</option>
                <option value="favorite_force">Favorite Force</option>
                <option value="favorite_intelligence">Favorite Intelligence</option>
                <option value="favorite_dexterity">Favorite Dexterity</option>
              </select>
            </div>

            <div class="field">
              <label for="gain-per-level"
                title="Flat stat gain per level applied to the selected stat progression model.">Base attributes gain
                per
                level</label>
              <input type="number" id="gain-per-level" name="gain_per_level" min="0" step="0.1">
            </div>

            <div class="field">
              <label for="unarmed-growth" title="Percent growth of unarmed damage per level.">Unarmed growth per
                level</label>
              <input type="number" id="unarmed-growth" name="unarmed_growth" min="0" step="0.001">
            </div>
          </div>
        </details>

      </div>
      </div>
      <div class="chart-sections-row">
        <details class="form-section form-section-attack-speed" open style="background-color: #0f4b3c;"
          data-chart-group="core">
          <summary class="section-title">Attack Per Second (APS)</summary>
          <div class="field-grid">
            <div class="field full-span chart-field">
              <canvas id="attack-speed-chart" height="240"></canvas>
            </div>


            <div class="field range-field">
              <div class="range-pair">
                <span>APS from</span>
                <input type="number" id="attack-speed-min" name="attack_speed_min" min="0" step="0.01"
                  class="range-limit no-fader">
                <span>to</span>
                <input type="number" id="attack-speed-max" name="attack_speed_max" min="0" step="0.01"
                  class="range-limit no-fader">
              </div>
            </div>
            <div class="field">
              <label for="attack-speed-power" title="Curve exponent; 1 = linear.">APS curve</label>
              <input type="number" id="attack-speed-power" name="attack_speed_power_progression" min="0" step="0.1">
            </div>
            <div class="field">
              <input type="number" id="attack-speed-slots-auto" name="attack_speed_slots_auto" readonly
                class="hidden-input">
              <div>
                Character can equip up to <span id="attack-speed-slots-meta" class="red"></span> APS modifiers
              </div>
            </div>
          </div>
        </details>

        <details class="form-section form-section-flat-dmg" open style="    background-color: #ab3a11"
          data-chart-group="core">
          <summary class="section-title">Flat DMG</summary>
          <div class="field-grid">
            <div class="field full-span chart-field">

              <canvas id="flat-damage-chart" height="240"></canvas>
            </div>

            <div class="field range-field">
              <div class="range-pair">
                <span>FlatDmg from</span>
                <input type="number" id="flat-damage-min" name="flat_damage_min" min="0" step="1"
                  class="range-limit no-fader">
                <span>to</span>
                <input type="number" id="flat-damage-median" name="flat_damage_max" min="0" step="1"
                  class="range-limit no-fader">
              </div>
            </div>
            <div class="field-grid">
              <div class="field">
                <label for="flat-damage-power"
                  title="Exponent applied to level for flat dmg progression (lvl^power).">Flat dmg curve</label>
                <input type="number" id="flat-damage-power" name="flat_damage_power_progression" min="0" step="0.1">
              </div>
              <div class="field">
                <label for="flat-damage-jitter"
                  title="Random jitter applied around the median flat damage (as a percent).">Flat dmg jitter
                  (%)</label>
                <input type="number" id="flat-damage-jitter" name="flat_damage_jitter_pct" min="0" max="1" step="0.01">
              </div>

              <div class="field">
                <label for="flat-damage-onehand-ratio"
                  title="Multiplier applied to flat dmg for one-handed weapons.">One
                  hand ratio</label>
                <input type="number" id="flat-damage-onehand-ratio" name="flat_damage_onehand_ratio" min="0" max="1"
                  step="0.01">
              </div>
              <div class="field">
                <input type="number" id="flat-damage-slots-auto" name="flat_damage_equipement_slots_auto" readonly
                  class="hidden-input">
                <div>
                  Character can equip up to <span id="flat-damage-slots-meta" class="red"></span> items that source flat
                  dmg
                </div>
              </div>
            </div>

          </div>
        </details>

        <details class="form-section form-section-mod-dmg" open style="    background-color: #651212;"
          data-chart-group="core">
          <summary class="section-title">DMG modifiers</summary>
          <div class="field-grid">
            <div class="field full-span chart-field">

              <canvas id="mod-damage-chart" height="240"></canvas>
            </div>


            <div class="field range-field">
              <div class="range-pair">
                <span>Dmg mod from</span>
                <input type="number" id="mod-damage-min" name="mod_damage_min" min="0" step="1"
                  class="range-limit no-fader">
                <span>to</span>
                <input type="number" id="mod-damage-max" name="mod_damage_max" min="0" step="1"
                  class="range-limit no-fader">
              </div>
            </div>
            <div class="field-grid">
              <div class="field">
                <label for="mod-damage-power" title="Curve exponent; 1 = linear.">Final dmg curve</label>
                <input type="number" id="mod-damage-power" name="mod_damage_power_progression" min="0" step="0.1">
              </div>
              <div class="field">
                <label for="mod-damage-jitter"
                  title="Random jitter applied around the median final dmg (as a percent).">Final dmg jitter (%)</label>
                <input type="number" id="mod-damage-jitter" name="mod_damage_jitter_pct" min="0" max="1" step="0.01">
              </div>
              <div class="field">
                <label for="mod-damage-slots-auto">Slots using mods</label>
                <input type="number" id="mod-damage-slots-auto" name="mod_damage_slots_auto" readonly>
              </div>
            </div>
          </div>
        </details>

        <details class="form-section form-section-dps-planning" open style="background-color: #312e81;"
          data-chart-group="core">
          <summary class="section-title">Damage Per Second (DPS)</summary>
          <div class="field-grid">
            <div class="field full-span chart-field">
              <canvas id="dps-planning-chart" height="240"></canvas>
            </div>
            <div class="field full-span">
              <details class="form-section" style="background-color: rgba(49,46,129,0.25);" open>
                <summary class="section-title">see DPS per level</summary>
                <div class="field full-span">
                  <div id="dps-planning-list" class="dps-planning-list"></div>
                </div>
              </details>
            </div>
          </div>
        </details>
        </details>
      </div>
      <div class="chart-sections-row future-row">
        <details class="form-section" style="background-color: #1c3d50;" data-chart-group="future" open>
          <summary class="section-title">XP Configuration</summary>
          <div class="field-grid">
            <div class="field full-span chart-field">

              <canvas id="xp-curve" height="240"></canvas>
            </div>
            <div class="field range-field">
              <div class="range-pair">
                <span> XP base</span>
                <input type="number" id="xp-base" name="xp_base" min="1" step="1" class="range-limit no-fader">
                <span>multiplier</span>
                <input type="number" id="xp-multiplier" name="xp_multiplier" min="0" step="0.1"
                  class="range-limit no-fader">
              </div>
            </div>
            <div class="field">
              <label for="xp-growth" title="Exponent applied to level for XP requirement.">XP growth</label>
              <input type="number" id="xp-growth" name="xp_growth" min="0" step="0.01">
            </div>
          </div>
          <details class="form-section xp-table">
            <summary class="section-title">see XP per level</summary>
            <div class="xp-levels" id="xp-levels"></div>
          </details>
        </details>
        <details class="form-section" style="background-color: #1f3c4e;" open>
          <summary class="section-title">Level Time & Loot Distribution</summary>
          <div class="field-grid">
            <div class="field-grid inline-four">
              <div class="field">
                <label for="median-time-per-level"
                  title="Average seconds to gain a level before modifiers. Drives number of loots per level.">Median
                  time
                  per level (s)</label>
                <input type="number" id="median-time-per-level" name="median_time_per_level" min="1" step="1">
              </div>
              <div class="field">
                <label for="median-time-per-loot"
                  title="Average seconds to obtain one loot; lower = more drops per level.">Median time per loot
                  (s)</label>
                <input type="number" id="median-time-per-loot" name="median_time_per_loot" min="1" step="1">
              </div>
              <div class="field">
                <label for="level-time-multiplier"
                  title="Exponential growth factor of time per level. Higher = slower higher levels.">Level time
                  multiplier</label>
                <input type="number" id="level-time-multiplier" name="level_time_multiplier" min="0" step="0.1">
              </div>
              <div class="field">
                <label for="additional-loot-factor" title="Multiplier on the number of loots rolled per level.">Loot
                  augmentation per level</label>
                <input type="number" id="additional-loot-factor" name="additional_loot_factor" min="0" step="0.01">
              </div>
            </div>

            <div class="field-grid">
              <div class="field-separator"></div>

              <div class="field">
                <label for="affix-rarity-scale" title="Scales affix min/max with rarity (0 = none).">Affix rarity
                  scale</label>
                <input type="number" id="affix-rarity-scale" name="affix_rarity_scale" min="0" step="0.01">
              </div>

              <label for="rarity-weight-growth"
                title="Adds weight to higher rarities per level; affects loot distribution.">Rarity weight
                growth</label>
              <input type="number" id="rarity-weight-growth" name="rarity_weight_growth" min="0" step="0.001">
            </div>

            <div class="field">
              <label for="attr-per-level-factor"
                title="Extra affix count scaling with level for each category.">Attributes per level factor</label>
              <input type="number" id="attr-per-level-factor" name="attr_per_level_factor" min="0" step="0.001">
            </div>
          </div>
        </details>
        <details class="form-section" style="background-color: #2a2b57;" data-chart-group="future" open>
          <summary class="section-title">Damage Sources</summary>
          <div class="field-grid">
            <div class="field">
              <div class="notice">Empty slot for future UI content.</div>
            </div>
          </div>
        </details>
        <details class="form-section" style="background-color: #3b1f38;" data-chart-group="future" open>
          <summary class="section-title">Resist Balance</summary>
          <div class="field-grid">
            <div class="field">
              <div class="notice">Empty slot for future UI content.</div>
            </div>
          </div>
        </details>
      </div>
    </form>
    <section class="compute-panel">
      <div class="compute-panel-inner">
        <div class="panel-label">Simulation</div>
        <div class="compute-panel-controls">
          <label for="generate-percent">
            How much loot is generated (%)
          </label>
          <input type="number" id="generate-percent" name="generate_percent" min="1" max="100" step="1"
            class="compute-input">
        </div>
        <button id="compute-btn" type="button" class="compute-btn">Compute all levels</button>
      </div>
    </section>
    <div class="result-area">
      <div id="config-alert" class="config-alert" aria-live="polite"></div>
      <div id="compute-result" class="compute-result"></div>
    </div>
    <pre id="config-preview" class="config-preview"></pre>
  </main>

</body>

</html>